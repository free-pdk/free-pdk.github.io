<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Undocumented Features | Free PDK</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Undocumented Features" />
<meta property="og:locale" content="en" />
<meta name="description" content="Free PDK is an effort to create an open source alternative to the proprietary Padauk µC programmer, as well as adding support to SDCC for Padauk µCs." />
<meta property="og:description" content="Free PDK is an effort to create an open source alternative to the proprietary Padauk µC programmer, as well as adding support to SDCC for Padauk µCs." />
<meta property="og:site_name" content="Free PDK" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Undocumented Features" />
<script type="application/ld+json">
{"description":"Free PDK is an effort to create an open source alternative to the proprietary Padauk µC programmer, as well as adding support to SDCC for Padauk µCs.","url":"/undocumented-features","@type":"WebPage","headline":"Undocumented Features","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Free PDK" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Free PDK</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/tutorial">Tutorial</a><a class="page-link" href="/undocumented-features">Undocumented Features</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
  <article class="post">

  <header class="post-header">
    <h1 class="post-title">Undocumented Features</h1>
  </header>

  <div class="post-content">
    <div class="callout">
  <p>This page is still incomplete. Please contribute by clicking on the <code class="language-plaintext highlighter-rouge">Edit this page on GitHub</code> link at the bottom of this page.</p>
</div>

<div class="toc">
  <h4 class="no_toc" id="table-of-contents">Table of Contents</h4>

<ol id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#16-mhz-system-clock-all-mcus" id="markdown-toc-16-mhz-system-clock-all-mcus">16 MHz System Clock (All MCUs)</a></li>
  <li><a href="#resistance-to-frequency-converter-pfs154-and-pfs173" id="markdown-toc-resistance-to-frequency-converter-pfs154-and-pfs173">Resistance to Frequency Converter (PFS154 and PFS173)</a></li>
  <li><a href="#11-bit-adc-pfs173" id="markdown-toc-11-bit-adc-pfs173">11 Bit ADC (PFS173)</a></li>
</ol>

</div>

<h2 id="introduction">
<a href="#introduction"><img class="emoji" title=":link:" alt=":link:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png" height="20" width="20"></a> Introduction</h2>

<p>This page lists features that were intentionally removed from the documentation by Padauk, but are still available in several microcontrollers. In some cases the reason for this seems to be marginal performance, in other cases the reason is not entirely clear.</p>

<p>Please keep in mind that using these features in your design comes with some risks:</p>

<ul>
  <li>They may cease to work under certain circumstances, for example increased temperature.</li>
  <li>It is likely that Padauk is not testing these features in their production testing. Therefore you may encounter devices where these features are defective.</li>
  <li>Padauk may remove these features from their products without notice.</li>
</ul>

<h2 id="16-mhz-system-clock-all-mcus">
<a href="#16-mhz-system-clock-all-mcus"><img class="emoji" title=":link:" alt=":link:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png" height="20" width="20"></a> 16 MHz System Clock (All MCUs)</h2>

<p>The CPU system clock is configured in the <em>clkmd</em> register that is present on all MCUs. The highest clock speed setting is 8 MHz, derived from dividing the clock speed of the internal high-speed RC oscillator (IHRC) by two. A setting for a clock divider of one is absent from all devices. Notably there is a bit combination marked as <em>reserved</em>.</p>

<p class="center"><img src="/assets/img/clkclmd_pfs154.png" alt="clkcmd register description for PFS154"></p>

<p>Selecting this bit combination will set the clock divider to one and will therefore allow setting the system clock to 16 MHz. One issue is that the MCU is only stable at this clock at a relatively high supply voltage (VDD) close to 5V. For example, the minimum voltage where the PFS173 can be clocked at 16 MHz is 4.0V. Most likely even higher voltages are required at temperatures higher than room temperature. It is possible that 16 MHz core clock will cease to work if a certain environmental temperature is exceed.</p>

<p>Therefore, it is necessary to ensure that the supply voltage has reached a sufficiently high level before activating the 16 MHz clock setting to prevent crashing of the MCU. This can be achieved by activating the low-voltage-reset feature (LVR), <a href="tutorial">see tutorial page</a>. Discussion <a href="https://www.eevblog.com/forum/blog/eevblog-1144-padauk-programmer-reverse-engineering/msg3262072/?PHPSESSID=k35321s2v4vtjpphogkgu8ts14#msg3262072">here</a> and following posts.</p>

<p>Example code for PFS154 and PFS173:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unsigned char _sdcc_external_startup(void)
{
	MISCLVR = MISCLVR_4V;
	CLKMD = CLKMD_IHRC_DIV | CLKMD_ENABLE_IHRC;  // 16/1=16 Mhz main clock
	// Optional: add clock calibration here
	return 0; // perform normal initialization
}
</code></pre></div></div>

<p>Alternatively you can use the <code class="language-plaintext highlighter-rouge">EASY_PDK_INIT_SYSCLOCK_16MHZ()</code> define provided with the Free-PDK environment.</p>

<h2 id="resistance-to-frequency-converter-pfs154-and-pfs173">
<a href="#resistance-to-frequency-converter-pfs154-and-pfs173"><img class="emoji" title=":link:" alt=":link:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png" height="20" width="20"></a> Resistance to Frequency Converter (PFS154 and PFS173)</h2>

<p>The resistance to frequency converter (RFC) is mentioned as a footnote in Paudaks product line card, but no devices are listed with this feature. A description of the peripheral was <a href="https://www.eevblog.com/forum/blog/eevblog-1144-padauk-programmer-reverse-engineering/msg3231126/#msg3231126">found</a> in a data-sheet for a discontinued MCU at a distributor. The document in question <a href="/assets/pdf/ptbo165cxxs.pdf">was saved here</a> and describes the operation in detail.</p>

<p>This peripheral measures a time constant defined by an externally connected resistor-capacitor pair. It can be used for various sensing applications where a change in resistance or capacitance needs to be measured.</p>

<p>It was noted that the RFC is present in at least the current revisions of PFS154 and PFS173, despite not being mentioned in the datasheet. More details can be found <a href="https://www.eevblog.com/forum/blog/eevblog-1144-padauk-programmer-reverse-engineering/msg3230752/#msg3230752">here</a>. The RFC is located at I/O 0x36-0x38 in the PFS154 and 0x2d-0x2f in the PFS173.</p>

<p>The RFC consists of a relaxation oscillator and a 16-bit counter. The frequency of the oscillator is defined by an RC pair connected to a selectable I/O pin. The counter will count the number of pulses after being started by setting a bit in the I/O register. The counter value after a defined time is representative of oscillator-frequency and hence of the RC time constant.</p>

<p class="center"><img src="/assets/img/rfc.png" alt="RFC register set"></p>

<p>You can find some electrical characterization results and usage examples <a href="https://hackaday.io/project/174822/logs">in this HaD.io project</a>.</p>

<h2 id="11-bit-adc-pfs173">
<a href="#11-bit-adc-pfs173"><img class="emoji" title=":link:" alt=":link:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f517.png" height="20" width="20"></a> 11 Bit ADC (PFS173)</h2>

<p>Register 0x23, which is part of the ADC peripheral I/O block in the PFS173, is notably absent from the documentation of the I/O space.</p>

<p class="center"><img src="/assets/img/adc_pfs173.png" alt="PFS173 ADC result register"></p>

<p>Probing this register shows that bits 7-5 are readable and seem to represent three additional least significant bits of the ADC result. It is not clear why these bits were left undocumented. Possibly they were deemed too noisy, or malfunction under certain settings. More investigation is needed here.</p>

<p>The undocumented register <code class="language-plaintext highlighter-rouge">ADCRL</code> can be accessed like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	__sfr __at(0x23)         _adcrl;
	#define ADCRL            _adcrl

	uint8_t adcout  =ADCR;			// Read most significant bits
	uint8_t adcoutl =ADCRL&gt;&gt;5; 		// Read three hidden bits
	uint16_t adc=(adcout&lt;&lt;3)|adcoutl;  	// adc contains 11 bit result	
</code></pre></div></div>

  </div>

</article>

<div class="edit-page">
  <a href="https://github.com/free-pdk/free-pdk.github.io/edit/production/undocumented-features.md">
    Edit this page on GitHub
  </a>
  <br>
  <small>
    Checkout <a href="/doc-style">/doc-style</a> for more information on some of the special Markdown formatting features we use.
  </small>
</div>

</div>

    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Free PDK</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Free PDK</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/free-pdk"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">free-pdk</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Free PDK is an effort to create an open source alternative to the proprietary
Padauk µC programmer, as well as adding support to SDCC for Padauk µCs.
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>